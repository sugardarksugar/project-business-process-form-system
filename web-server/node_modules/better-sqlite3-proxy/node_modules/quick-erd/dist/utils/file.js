"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.readPackageJSON = exports.addDependencies = exports.writeSrcFile = exports.readErdFromStdin = void 0;
const fs_1 = require("fs");
function readErdFromStdin(cb) {
    if (process.stdin.isTTY) {
        console.error('Reading erd from stdin... (Please pipe erd text to stdin)');
    }
    let text = '';
    process.stdin
        .on('data', chunk => (text += chunk))
        .on('end', () => {
        if (!text) {
            console.error('missing erd text from stdin');
            process.exit(1);
        }
        cb(text);
    });
}
exports.readErdFromStdin = readErdFromStdin;
function writeSrcFile(file, code) {
    console.error('saving to', file, '...');
    code = code.trim() + '\n';
    (0, fs_1.writeFileSync)(file, code);
}
exports.writeSrcFile = writeSrcFile;
function addDependencies(name, version, mode) {
    const file = 'package.json';
    const pkg = JSON.parse((0, fs_1.readFileSync)(file).toString());
    const field = mode === 'dev' ? 'devDependencies' : 'dependencies';
    const deps = (pkg[field] = pkg[field] || {});
    if (name in deps) {
        return;
    }
    deps[name] = version;
    const text = JSON.stringify(pkg, null, 2);
    writeSrcFile(file, text);
}
exports.addDependencies = addDependencies;
function readPackageJSON(file) {
    const pkg = JSON.parse((0, fs_1.readFileSync)(file).toString());
    return pkg;
}
exports.readPackageJSON = readPackageJSON;
